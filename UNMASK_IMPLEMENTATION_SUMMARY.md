# TikTok Unmask Implementation Summary

## Complete Unmask Flow (CONFIRMED)

### User Flow:
1. Navigate to order detail page: `https://seller-my.tiktok.com/order/detail?order_no=581769084568176530&shop_region=MY`
2. Click **Name** unmask button → Get name
3. Click **Phone** unmask button → Get phone
4. Click **Address** unmask button → Get address

### Technical Flow:
Each unmask button triggers:
1. `https://sgali-mcs.byteoversea.com/list` (logging/tracking)
2. `https://mssdk-sg.tiktok.com/web/report` (analytics)
3. `https://seller-my.tiktok.com/api/fulfillment/orders/buyer_contact_info/get` (actual data)

## API Responses

### Name Unmask
```json
{
  "code": 0,
  "data": {
    "plain_text_name": "Cik Peah"
  },
  "message": "success"
}
```

### Phone Unmask
```json
{
  "code": 0,
  "data": {
    "plain_text_phone_number": "(+60)162538703"
  },
  "message": "success"
}
```

### Address Unmask
```json
{
  "code": 0,
  "data": {
    "plain_text_address": {
      "items": [
        {"key": "zipcode", "value": "42000"},
        {"key": "address", "value": "NO 86 JALAN 9 KAMPUNG IDAMAN"},
        {"key": "address_detail", "value": ""},
        {"key": "house_number", "value": ""}
      ],
      "region": {
        "name": "Malaysia",
        "geoname_id": "1733045"
      },
      "districts": [
        {"name": "Selangor", "geoname_id": "1733037"},
        {"name": "Pelabuhan Klang", "geoname_id": "120000051"}
      ]
    }
  },
  "message": "success"
}
```

## Why Browser Automation is Required

### 1. Anti-Bot Protection
- `X-Bogus` and `X-Gnarly` signatures change per request
- Generated by obfuscated JavaScript
- Impossible to replicate programmatically without reverse engineering

### 2. Session-Based Authentication
- Requires logged-in browser session
- Session cookies track which order page you're on
- No order ID in API parameters (context-dependent)

### 3. Multiple API Calls
- Must click 3 separate buttons
- Each returns different data
- Must be done in context of order detail page

## Implementation Recommendation

### Approach: Puppeteer Browser Automation

**Architecture**:
```
React Frontend → Backend API → Puppeteer Service → TikTok Seller Center
```

**Process**:
1. User clicks "Unmask Selected Orders" button in Processed.jsx
2. Frontend calls backend `/api/unmask` endpoint
3. Backend Puppeteer service:
   - Logs into TikTok Seller Center (reuses existing session)
   - For each order:
     - Navigate to order detail page
     - Click name unmask button → capture response
     - Click phone unmask button → capture response
     - Click address unmask button → capture response
     - Combine all 3 responses
   - Returns combined customer data
4. Frontend updates database with unmasked data

**Implementation Time**: ~2-3 days

**Required**:
- Node.js backend server
- Puppeteer library
- TikTok Seller Center login credentials (encrypted storage)
- Session management logic

## Alternative: Manual Workflow

If automation is too complex or risky, consider:

### Simplified Approach
1. User manually unmasks orders in TikTok Seller Center (one-time action)
2. App provides "Sync Data" button
3. Puppeteer scrapes already-unmasked data from order list page
4. No clicking unmask buttons - just reading visible data

**Benefits**:
- Less likely to violate TikTok ToS
- Simpler implementation
- Lower risk of account suspension
- Faster (no waiting for unmask API calls)

## Data Structure for Database

After unmasking, save to Supabase:

```javascript
{
  order_id: "581769084568176530",
  customer_name: "Cik Peah",
  customer_phone: "(+60)162538703",
  customer_address: "NO 86 JALAN 9 KAMPUNG IDAMAN, 42000 Pelabuhan Klang, Selangor, Malaysia",
  customer_address_details: {
    zipcode: "42000",
    address: "NO 86 JALAN 9 KAMPUNG IDAMAN",
    address_detail: "",
    house_number: "",
    region: "Malaysia",
    districts: ["Selangor", "Pelabuhan Klang"]
  },
  is_unmasked: true,
  unmasked_at: "2025-01-15T10:30:00Z"
}
```

## Security & Compliance

### Risks
1. **TikTok ToS**: Automated access may violate Terms of Service
2. **Account Suspension**: Risk of seller account ban
3. **Privacy**: Storing customer data requires compliance with local privacy laws
4. **Rate Limiting**: Too many requests may trigger blocks

### Mitigation
1. **User Consent**: Add clear disclaimer about automation risks
2. **Rate Limiting**: Add 2-3 second delays between unmask requests
3. **Human-like Behavior**: Randomize delays, mouse movements
4. **Secure Storage**: Encrypt customer data in database
5. **Compliance**: Follow GDPR/privacy laws for data storage
6. **Monitoring**: Log all unmask actions for audit trail

## Next Steps

### Option A: Full Automation
1. Set up Node.js backend project
2. Install Puppeteer: `npm install puppeteer`
3. Implement login automation
4. Find correct DOM selectors for unmask buttons
5. Implement network interception to capture API responses
6. Create backend API endpoint for frontend
7. Add unmask button to Processed.jsx
8. Test with small batch of orders
9. Monitor for errors/blocks

**Files to create**:
- `backend/server.js`
- `backend/services/puppeteerService.js`
- `backend/services/unmaskService.js`
- `backend/routes/unmask.js`
- Update `src/pages/Processed.jsx`
- Update `src/components/BulkActions.jsx`

### Option B: Manual + Sync
1. User manually unmasks in TikTok Seller Center
2. Create "Sync Unmasked Data" button in app
3. Puppeteer scrapes visible (already unmasked) data
4. Update database

**Files to create**:
- `backend/services/syncService.js`
- `backend/routes/sync.js`
- Update `src/pages/Processed.jsx`

## Estimated Costs

### Development
- Backend setup: 4 hours
- Puppeteer implementation: 8 hours
- Frontend integration: 2 hours
- Testing & debugging: 4 hours
- **Total**: ~18 hours

### Infrastructure
- VPS for backend: $5-20/month
- Or AWS Lambda (serverless): Pay per use
- Database (Supabase): Free tier sufficient

### Ongoing
- Maintenance for UI changes: ~2 hours/month
- Monitoring & bug fixes: As needed

## Decision Matrix

| Criterion | Full Automation | Manual + Sync | Do Nothing |
|-----------|----------------|---------------|------------|
| Development Effort | High | Medium | None |
| User Experience | Excellent | Good | Poor |
| ToS Risk | High | Low | None |
| Reliability | Medium | High | N/A |
| Maintenance | High | Low | None |
| Cost | $20-50/mo | $5-10/mo | Free |

## Recommendation

**Start with Option B (Manual + Sync)**:
1. Lower risk of ToS violation
2. Simpler implementation
3. User already has to visit TikTok Seller Center to ship orders
4. Can upgrade to full automation later if needed

Once proven stable, consider Option A (Full Automation) if:
- User ships >50 orders/day
- Manual unmask becomes bottleneck
- TikTok doesn't block the automation

## Questions for User

1. How many orders do you ship per day?
2. Are you willing to accept the risk of account suspension?
3. Do you prefer full automation or manual + sync approach?
4. Do you have a backend server already, or need help setting one up?
5. What's your budget for this feature?
