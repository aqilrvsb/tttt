# TikTok Unmask API Analysis

## Discovered Endpoints

### Two-Step Unmask Process

When clicking the unmask button, **TWO** API calls are triggered:

#### Step 1: List Request
**URL**: `https://sgali-mcs.byteoversea.com/list`
**Purpose**: Unknown - possibly authorization check or logging unmask action
**Type**: ByteDance internal API

#### Step 2: Get Buyer Contact Info
**URL**: `https://seller-my.tiktok.com/api/fulfillment/orders/buyer_contact_info/get`
**Method**: GET
**Type**: Internal Seller Center Web API (NOT official TikTok Shop API)
**Purpose**: Retrieve unmasked customer contact information

## Full URL Parameters

```
locale=en-GB
language=en-GB
oec_seller_id=7495829864189955041
seller_id=7495829864189955041
aid=4068
app_name=i18n_ecom_shop
fp=verify_mjfbxvul_AVOSc33I_NC62_4QHM_8zEO_U7N498OtdIdz
device_platform=web
cookie_enabled=true
screen_width=1536
screen_height=864
browser_language=en-US
browser_platform=Win32
browser_name=Mozilla
browser_version=5.0%20(Windows%20NT%2010.0%3B%20Win64%3B%20x64)%20AppleWebKit%2F537.36%20(KHTML%2C%20like%20Gecko)%20Chrome%2F143.0.0.0%20Safari%2F537.36
browser_online=true
timezone_name=Asia/Kuala_Lumpur
msToken=VIZ-TXsEHvLjzN5uznG812_A0JM-P7iD40pM1slp4wuZne7-k0NrP8H77TFEemBv05B4csQZYikqf4hNAEGJiFabxKonhzeaXQaqZ9T-JiUojNmfrZBZkHtNIsJ2q-v2NmjOyPwb
X-Bogus=DFSzswfLhY1gsoMECFHcqwwdsi3A
X-Gnarly=MxniT7yGzVI0KEJrbKQodMlhfdDoyLN5VvX/mDnOZVwdvV3FCRnqLCXg8W7HJbFm-Y-uf-sqXYZn0M1TT1NPJTO-A2QQDDELf72HEjRbqSLPf5c0uyhFCtGeGd75LaMu2ZeZ92EqWM/sax-OFg4fHHOVkHYSkGjO9MHToqUF0I-F0PNENccBULpgVEWRHt-PA5Tzp5I7ySeuuSNVtl/8hbvgxV66MsZhbTLOboKkxvw9aY8bQCReR/1AdHNoKYLcrIc4rwvGYlK5
```

## Critical Parameters

### 1. Order Identification
- **Missing**: No `order_id` or `order_no` parameter visible
- **Question**: Where is the order ID specified?
  - Check request body (if POST)
  - Check request headers
  - May be a different endpoint per order

### 2. Authentication Tokens

**X-Bogus**: `DFSzswfLhY1gsoMECFHcqwwdsi3A`
- TikTok's anti-bot signature
- Generated client-side
- Changes per request
- Extremely difficult to replicate

**X-Gnarly**: `MxniT7yGzVI0KEJrbKQodMlhfdDoyLN5VvX/mDnOZVwdvV3FCRnqLCXg8W7HJbFm...`
- Another TikTok security signature
- Also changes per request
- Requires reverse engineering

**msToken**: `VIZ-TXsEHvLjzN5uznG812_A0JM-P7iD40pM1slp4wuZne7-k0NrP8H77TFEemBv...`
- Session token
- Stored in cookies
- Short-lived (expires)

### 3. Seller Identification
- `seller_id`: 7495829864189955041
- `oec_seller_id`: 7495829864189955041

## Authentication Type

This endpoint uses **browser session authentication**, NOT API key authentication.

**What this means**:
- Cannot use `app_key` / `app_secret` from TikTok Shop API
- Requires cookies from logged-in browser session
- Requires dynamic signature generation (X-Bogus, X-Gnarly)
- Must maintain session state

## Implementation Challenges

### Challenge 1: No Official API Support
- This endpoint is internal to Seller Center
- Not part of the official TikTok Shop API
- No documentation
- May change without notice

### Challenge 2: Dynamic Security Signatures
- `X-Bogus` and `X-Gnarly` are anti-bot measures
- Generated by obfuscated JavaScript
- Extremely difficult to reverse engineer
- Changes frequently

### Challenge 3: Session Management
- Requires logged-in browser session
- Session expires (unknown duration)
- Need to handle session refresh
- Must store cookies securely

### Challenge 4: Missing Order ID
- **IMPORTANT**: The URL you provided doesn't show which order to unmask
- Need to check:
  - Request body (if POST)
  - Request headers
  - Other URL parameters
  - Or is there a different URL pattern per order?

## Complete API Analysis (CONFIRMED)

### Request Details
**Method**: GET
**Full URL**:
```
https://seller-my.tiktok.com/api/fulfillment/orders/buyer_contact_info/get?locale=en-GB&language=en-GB&oec_seller_id=7495829864189955041&seller_id=7495829864189955041&aid=4068&app_name=i18n_ecom_shop&fp=verify_mjfbxvul_AVOSc33I_NC62_4QHM_8zEO_U7N498OtdIdz&device_platform=web&cookie_enabled=true&screen_width=1536&screen_height=864&browser_language=en-US&browser_platform=Win32&browser_name=Mozilla&browser_version=5.0%20(Windows%20NT%2010.0;%20Win64;%20x64)%20AppleWebKit/537.36%20(KHTML,%20like%20Gecko)%20Chrome/143.0.0.0%20Safari/537.36&browser_online=true&timezone_name=Asia/Kuala_Lumpur&msToken=B_MHXlcuxCKGSQVOUsgGoIYd_OHR1lMQDfLIPfLp9dlW5CjQWuxN9fl5JIGoJKwS1klWn_TYZaFB6voWyb-XtYpUz3d7Vcl_6VjboBzlumAkwpf5SQQbrGhzd1j3D7svBJhsMrSi&X-Bogus=DFSzswfLOpBgsoMECFHam7wdsi3J&X-Gnarly=MahKTxKA/xroj0P2J0revGHZOUQWZIK7x5vCTaOa95Kb...
```

### Response Format (CONFIRMED)

**CRITICAL FINDING**: There are **3 SEPARATE unmask buttons** (one for each field)!

#### 1. Unmask Phone
Click phone unmask button → API call → Returns:
```json
{
  "code": 0,
  "data": {
    "plain_text_phone_number": "(+60)162538703"
  },
  "message": "success"
}
```

#### 2. Unmask Name
Click name unmask button → API call → Returns:
```json
{
  "code": 0,
  "data": {
    "plain_text_name": "Cik Peah"
  },
  "message": "success"
}
```

#### 3. Unmask Address (CONFIRMED)
Click address unmask button → API call → Returns:
```json
{
  "code": 0,
  "data": {
    "plain_text_address": {
      "items": [
        {"key": "zipcode", "value": "42000"},
        {"key": "address", "value": "NO 86 JALAN 9 KAMPUNG IDAMAN"},
        {"key": "address_detail", "value": ""},
        {"key": "house_number", "value": ""}
      ],
      "region": {
        "name": "Malaysia",
        "geoname_id": "1733045"
      },
      "districts": [
        {"name": "Selangor", "geoname_id": "1733037"},
        {"name": "Pelabuhan Klang", "geoname_id": "120000051"}
      ]
    }
  },
  "message": "success"
}
```

**IMPORTANT**: Same API endpoint (`/buyer_contact_info/get`), but returns different fields based on which unmask button was clicked!

This means Puppeteer automation must click **3 separate buttons** and make **3 separate API calls** to get complete customer data.

### Order Identification
**CRITICAL FINDING**: No `order_no` or `order_id` in the URL parameters!

The order context is determined by:
1. You must already be on the order detail page: `https://seller-my.tiktok.com/order/detail?order_no=XXXXXXX`
2. Server tracks which order page you're viewing via session/cookies
3. The unmask API call is made in the context of that page

## Implementation Options

### Option A: Browser Automation (Recommended)
Since the endpoint requires browser session and dynamic signatures, the most reliable approach is browser automation.

**Pros**:
- Works exactly like human
- No need to reverse engineer signatures
- Handles session automatically
- Reliable

**Cons**:
- Slower than direct API
- Requires browser runtime
- More complex setup

**Implementation**: Use Puppeteer to:
1. Login to Seller Center
2. Navigate to order detail page
3. Click unmask button
4. Extract customer data from DOM or network response

### Option B: Session Token Extraction
Extract session tokens from user's browser and reuse them.

**Pros**:
- Faster than browser automation
- Can make direct HTTP requests

**Cons**:
- Tokens expire frequently
- User must manually provide tokens
- Still need to handle X-Bogus/X-Gnarly signatures
- Very fragile

### Option C: Hybrid Approach
Use browser automation to extract session tokens, then make API calls directly.

**Pros**:
- Balance of speed and reliability
- Can batch unmask operations

**Cons**:
- Complex implementation
- Still requires signature generation
- Session expiry issues

## Recommended Approach

**Use Puppeteer Browser Automation**:

1. User provides TikTok Seller Center login credentials (email/password)
2. Automated browser logs in
3. For each order to unmask:
   - Navigate to order detail page
   - Click unmask button
   - Extract unmasked data
   - Save to database
4. Close browser

**Security Considerations**:
- Store login credentials securely (encrypted in database)
- Run browser automation on backend (not in React frontend)
- Rate limit to avoid detection
- Add delays to mimic human behavior

## Code Structure

```
Backend (Node.js):
├── src/
│   ├── automation/
│   │   ├── tiktokBrowser.js       # Puppeteer login & navigation
│   │   ├── unmaskOrders.js        # Unmask automation logic
│   │   └── sessionManager.js      # Handle browser sessions
│   └── api/
│       └── unmask.js              # API endpoint for React to call

Frontend (React):
└── src/
    └── pages/
        └── Processed.jsx          # Call backend unmask API
```

## Next Steps

1. **Provide full cURL command** from DevTools (with all headers, body, method)
2. **Check response format** - what data is returned?
3. **Decide on implementation** - browser automation vs token extraction
4. **Set up backend** - if using automation, need Node.js backend
5. **Implement and test**

## Questions to Answer

- [ ] What is the request method? (GET or POST)
- [ ] How is the order ID specified in the request?
- [ ] What does the response look like?
- [ ] What cookies are required?
- [ ] How long do session tokens last?
- [ ] Can we batch unmask multiple orders at once?
